import pandas as pd

# Đọc dữ liệu từ tập tin CSV
def load_data(file_path):
    return pd.read_csv(file_path)

# So sánh điểm tổng giữa hai sinh viên
def compare_total_score(df, sbd1, sbd2):
    student1 = df[df['sbd'] == sbd1]
    student2 = df[df['sbd'] == sbd2]
    
    if student1.empty or student2.empty:
        return "Một trong hai sinh viên không tồn tại."
    
    total1 = student1[['toan', 'ngu_van', 'ngoai_ngu', 'vat_li', 'hoa_hoc', 'sinh_hoc', 
                       'lich_su', 'dia_li', 'gdcd']].sum(axis=1).values[0]
    total2 = student2[['toan', 'ngu_van', 'ngoai_ngu', 'vat_li', 'hoa_hoc', 'sinh_hoc', 
                       'lich_su', 'dia_li', 'gdcd']].sum(axis=1).values[0]
    
    if total1 > total2:
        return f"Sinh viên {sbd1} có điểm tổng cao hơn sinh viên {sbd2}."
    elif total1 < total2:
        return f"Sinh viên {sbd2} có điểm tổng cao hơn sinh viên {sbd1}."
    else:
        return f"Hai sinh viên {sbd1} và {sbd2} có điểm tổng bằng nhau."

# Tìm sinh viên có điểm tổng gần nhau
def find_students_with_similar_scores(df, threshold=5):
    df['total_score'] = df[['toan', 'ngu_van', 'ngoai_ngu', 'vat_li', 'hoa_hoc', 'sinh_hoc', 
                            'lich_su', 'dia_li', 'gdcd']].sum(axis=1)
    similar_students = []
    
    for i in range(len(df)):
        for j in range(i + 1, len(df)):
            score_diff = abs(df.iloc[i]['total_score'] - df.iloc[j]['total_score'])
            if score_diff <= threshold:
                similar_students.append((df.iloc[i]['sbd'], df.iloc[j]['sbd'], score_diff))
    
    return similar_students

# Ví dụ sử dụng
if __name__ == "__main__":
    data_file = '../data/cleaned_data.csv'
    data = load_data(data_file)
    
    # So sánh điểm tổng giữa hai sinh viên
    result = compare_total_score(data, '123', '456')
    print(result)
    
    # Tìm sinh viên có điểm tổng gần nhau
    similar_students = find_students_with_similar_scores(data, threshold=3)
    print("Các sinh viên có điểm tổng gần nhau:")
    for sbd1, sbd2, diff in similar_students:
        print(f"SBD {sbd1} và SBD {sbd2} - Chênh lệch: {diff} điểm")
